<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Where can I find it</title>
  <style>
    /* Header styling */
    header {
      background-color: #222;
      text-align: center;
      padding: 0.9vw 0;
    }
    header img {
      max-width: 100%;
      height: auto;
    }
    
    /* Dark-themed responsive UI optimized for Android TV */
    body {
      background-color: #121212;
      color: #f1f1f1;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      font-size: 2.2vw; /* Base font size doubled */
    }
    .container {
      max-width: 960px;
      margin: auto;
      padding: 1.8vw;
      flex: 1;
    }
    h1 { text-align: center; }
    
    /* Search field styling */
    #searchInput {
      width: 300px;
      padding: 1vw;
      font-size: 2.2vw;
      border: 1px solid #444;
      border-radius: 0.9vw;
      margin-bottom: 1vw;
      outline: none;
    }
    #searchInput:focus {
      outline: 1px solid #1e90ff;
    }
    
    /* Search and Clear button styling */
    #searchButton, #clearButton {
      padding: 0.5vw 1vw;
      font-size: 2.2vw;
      border: 1px solid #1e90ff;
      border-radius: 0.9vw;
      background-color: #1e90ff;
      color: #fff;
      cursor: pointer;
      outline: none;
    }
    #searchButton:focus, #clearButton:focus {
      outline: 1px solid #fff;
    }
    
    /* Result styling */
    .result {
      border-bottom: 0.9vw solid #333;
      padding: 1.8vw;
      display: flex;
      flex-wrap: wrap;
    }
    .result img {
      max-width: 200px;
      height: auto;
      border-radius: 0.9vw;
      margin-right: 1.8vw;
      flex-shrink: 0;
      object-fit: contain;
    }
    .result-content {
      flex: 1;
    }
    .result-content h2 {
      font-size: 2.4vw;
      margin: 0 0 1vw 0;
    }
    .result-content p {
      margin: 0.5vw 0;
      font-size: 2.2vw;
    }
    .result-content strong {
      font-size: 2.2vw;
    }
    
    /* Clickable elements for remote control */
    .clickable {
      color: #1e90ff;
      cursor: pointer;
      display: inline-block;
    }
    .clickable:focus {
      outline: 1px solid #1e90ff;
    }
    
    /* Sections */
    .streaming, .actors, .collection, .known-for, .all-credits {
      margin-top: 1vw;
      font-size: 2.2vw;
    }
    
    /* Other Results styling as a grid with smaller cards */
    #otherResults {
      margin: 1.8vw 0;
    }
    #otherResults h3 {
      margin-bottom: 1vw;
      font-size: 2.2vw;
    }
    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1vw;
    }
    .card {
      background-color: #1e1e1e;
      border: 1px solid #444;
      border-radius: 0.9vw;
      padding: 1vw;
      text-align: center;
      cursor: pointer;
    }
    .card:focus {
      outline: 1px solid #1e90ff;
    }
    .card p {
      margin: 0.5vw 0;
      font-size: 2.2vw;
    }
    
    /* Footer styling */
    footer {
      text-align: center;
      padding: 1vw;
      border-top: 1px solid #333;
      font-size: 2.2vw;
      margin-top: 1.8vw;
    }
    footer img {
      max-width: 100px;
      height: auto;
      border-radius: 0.9vw;
      margin-top: 1vw;
    }
    
    /* Overlay styling for trailer playback */
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #overlay-content {
      position: relative;
      width: 80%;
      max-width: 800px;
    }
    #overlay-content iframe {
      width: 100%;
      height: 450px;
      border: none;
    }
    #close-overlay {
      position: absolute;
      top: -1vw;
      right: -1vw;
      background: #fff;
      color: #000;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 2.2vw;
      cursor: pointer;
      outline: none;
    }
    /* Unmute toggle button styling */
    #unmute-button {
      position: absolute;
      bottom: 1vw;
      right: 1vw;
      padding: 1vw 1.5vw;
      font-size: 2.2vw;
      background-color: #1e90ff;
      color: #fff;
      border: none;
      border-radius: 0.9vw;
      cursor: pointer;
      outline: none;
    }
    #unmute-button:focus {
      outline: 1px solid #fff;
    }
    /* Stop Trailer button styling */
    #stop-button {
      position: absolute;
      bottom: 1vw;
      left: 1vw;
      padding: 1vw 1.5vw;
      font-size: 2.2vw;
      background-color: #ff0000;
      color: #fff;
      border: none;
      border-radius: 0.9vw;
      cursor: pointer;
      outline: none;
    }
    #stop-button:focus {
      outline: 1px solid #fff;
    }
  </style>
</head>
<body>
  <header> 
    <center>
      <table style="width:90%;">
        <tr>
          <td style="width:20%; text-align: center;">
            <img src="https://thetechdad1027.github.io/wherecaniwatchit/0.png" style="width: 80%; height: 80%;">
          </td>
          <td style="text-align: center;">
            <input type="text" id="searchInput" placeholder="Search movies, TV shows, or actors..." tabindex="0">
          </td>
          <td style="width:20%; text-align: center;">
            <!-- Using inline-flex to display buttons side by side -->
            <div style="display: inline-flex; align-items: center;">
              <button id="searchButton" tabindex="0">Search</button>
              <button id="clearButton" tabindex="0" style="margin-left: 1vw;">Clear</button>
            </div>
          </td>
        </tr>
      </table>  
    </center> 
  </header> 

  <div class="container">
    <!-- Main result display -->
    <div id="mainResult"></div>
    <!-- Other Results displayed as a grid -->
    <div id="otherResults"></div>
  </div>

  <footer>
    <center>
      <table style="width:90%; font-size: 1.2vw;">
        <tr>
          <td style="width:15%; text-align: center;">
              The TechDad1027
              <img alt="thetechdad1027@gmail.com" src=".\Logo.png" style="width: 60%; height: 60%;">
              thetechdad1027@gmail.com
          </td>
          <td style="width:70%; text-align: center;">
            I'm accepting <strong>"Buy Me a Coffee"</strong> donations to help keep this web app free for everyone. 
            Your support covers costs like hosting, my time and development, helping me improve features without 
            relying on ads or fees. Every contribution mattersâ€”thank you for supporting my work!
          </td>
          <td style="width:15%; text-align: center;">
            <img src=".\Coffee.png" style="width: 70%; height: 70%;">
            <br><a href="https://buymeacoffee.com/thetechdad1027" style="color:white; font-size:1em;">Buy me a coffee!</a>
          </td>
        </tr>
      </table>
    </center> 
  </footer>

  <!-- Overlay for trailer playback -->
  <div id="overlay">
    <div id="overlay-content">
      <button id="close-overlay">&times;</button>
      <!-- The YouTube player will be inserted in the "player" div below -->
      <div id="player"></div>
      <!-- Unmute toggle button -->
      <button id="unmute-button" tabindex="0">Unmute</button>
      <!-- Stop Trailer button -->
      <button id="stop-button" tabindex="0">Stop Trailer</button>
    </div>
  </div>
  
  <script>
    // Load YouTube IFrame API
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player; // Global YT.Player instance

    const apiKey = "020fd53d900b9f0ece40d4ca501d5065";
    const baseImageUrl = "https://image.tmdb.org/t/p/w500";
    
    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const clearButton = document.getElementById('clearButton');
    const mainResult = document.getElementById('mainResult');
    const otherResultsContainer = document.getElementById('otherResults');
    const overlay = document.getElementById('overlay');
    const closeOverlayBtn = document.getElementById('close-overlay');
    const unmuteButton = document.getElementById('unmute-button');
    const stopButton = document.getElementById('stop-button');
    
    let searchResults = [];
    
    // Removed the listener that clears the search field on focus.
    
    // Listener for clear button
    clearButton.addEventListener('click', () => {
      searchInput.value = "";
    });
    
    // Trigger search on Enter key press
    searchInput.addEventListener('keydown', (e) => {
      if(e.key === "Enter") {
        performSearch(searchInput.value.trim());
      }
    });
    
    // Trigger search on button click
    searchButton.addEventListener('click', () => {
      performSearch(searchInput.value.trim());
    });
    
    function performSearch(query) {
      mainResult.innerHTML = "";
      otherResultsContainer.innerHTML = "";
      searchResults = [];
      
      mainResult.innerHTML = "<p>Loading...</p>";
      const url = `https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&query=${encodeURIComponent(query)}`;
      
      fetch(url)
        .then(response => response.json())
        .then(data => {
          if(data.results && data.results.length > 0) {
            searchResults = data.results;
            renderMainResult(searchResults[0]);
            // Only build "You may also be looking for:" if main result is not a person
            if(searchResults.length > 1 && searchResults[0].media_type !== "person") {
              buildOtherResults(searchResults.slice(1));
            }
          } else {
            mainResult.innerHTML = "<p>No results found.</p>";
          }
        })
        .catch(error => {
          console.error("Error fetching data:", error);
          mainResult.innerHTML = "<p>Error fetching data. Please try again later.</p>";
        });
    }
    
    function fetchMediaDetails(item) {
      const type = item.media_type;
      const endpoint = type === "movie" ? "movie" : "tv";
      const url = `https://api.themoviedb.org/3/${endpoint}/${item.id}?api_key=${apiKey}&append_to_response=watch/providers,videos,credits,next_episode_to_air`;
      return fetch(url).then(response => response.json())
        .then(details => {
          if(!details.media_type && details.hasOwnProperty("next_episode_to_air")){
            details.media_type = "tv";
          }
          return details;
        });
    }
    
    function renderMainResult(item) {
      mainResult.innerHTML = "";
      if(item.media_type === "movie" || item.media_type === "tv") {
        fetchMediaDetails(item)
          .then(details => {
            renderMediaResult(details, mainResult);
          })
          .catch(error => {
            console.error("Error fetching details:", error);
            mainResult.innerHTML = "<p>Error loading detailed information.</p>";
          });
      } else if(item.media_type === "person") {
        renderPersonResult(item, mainResult);
      }
    }
    
    // Build Other Results as a grid of cards (multiple rows)
    function buildOtherResults(results) {
      const container = otherResultsContainer;
      container.innerHTML = "";
      
      const header = document.createElement('h3');
      header.textContent = "You may also be looking for:";
      container.appendChild(header);
      
      const gridContainer = document.createElement('div');
      gridContainer.className = "card-container";
      gridContainer.style.display = "grid";
      gridContainer.style.gridTemplateColumns = "repeat(auto-fill, minmax(150px, 1fr))";
      gridContainer.style.gap = "1vw";
      
      results.slice(0, 10).forEach((item) => {
        const card = document.createElement('div');
        card.className = "card";
        card.setAttribute("tabindex", "0");
        
        const cardTitle = document.createElement('p');
        cardTitle.textContent = item.title || item.name || "Untitled";
        card.appendChild(cardTitle);
        
        let releaseYear = "";
        if(item.release_date) {
          releaseYear = new Date(item.release_date).getFullYear();
        } else if(item.first_air_date) {
          releaseYear = new Date(item.first_air_date).getFullYear();
        }
        if(releaseYear) {
          const yearP = document.createElement('p');
          yearP.textContent = releaseYear;
          card.appendChild(yearP);
        }
        
        card.addEventListener('click', () => {
          renderMainResult(item);
        });
        
        gridContainer.appendChild(card);
      });
      
      container.appendChild(gridContainer);
    }
    
    function renderMediaResult(item, container) {
      const div = document.createElement('div');
      div.className = "result";
      
      const img = document.createElement('img');
      if(item.poster_path) {
        img.src = baseImageUrl + item.poster_path;
      } else {
        img.alt = "No Image Available";
      }
      div.appendChild(img);
      
      const contentDiv = document.createElement('div');
      contentDiv.className = "result-content";
      
      const title = document.createElement('h2');
      title.textContent = item.title || item.name;
      contentDiv.appendChild(title);
      
      // Description
      const overview = document.createElement('p');
      overview.textContent = item.overview || "No description available.";
      contentDiv.appendChild(overview);
      
      // For TV shows: next episode air date
      if(item.media_type === "tv") {
        const nextEpisode = document.createElement('p');
        nextEpisode.style.marginTop = "1vw";
        if(item.next_episode_to_air && item.next_episode_to_air.air_date) {
          nextEpisode.innerHTML = `<strong>Next Episode Air Date:</strong> ${item.next_episode_to_air.air_date}`;
        } else {
          nextEpisode.innerHTML = `<strong>Next Episode Air Date:</strong> Not available`;
        }
        contentDiv.appendChild(nextEpisode);
      }
      
      // Available Trailers Section
      if(item.videos && item.videos.results && item.videos.results.length > 0) {
        const trailer = item.videos.results.find(video => video.type === "Trailer" && video.site === "YouTube");
        if(trailer) {
          const trailerSection = document.createElement('p');
          trailerSection.innerHTML = "<strong>Available Trailers:</strong> ";
          const playLink = document.createElement('a');
          playLink.href = "#";
          playLink.textContent = "Play";
          playLink.className = "clickable";
          playLink.addEventListener('click', (e) => {
            e.preventDefault();
            openOverlay(trailer.key);
          });
          trailerSection.appendChild(playLink);
          contentDiv.appendChild(trailerSection);
        }
      }
      
      // Collection Section for movies (if available)
      if(item.media_type === "movie" && item.belongs_to_collection) {
        const collectionDiv = document.createElement('div');
        collectionDiv.className = "collection";
        collectionDiv.innerHTML = "<strong>Collection:</strong> ";
        fetch(`https://api.themoviedb.org/3/collection/${item.belongs_to_collection.id}?api_key=${apiKey}`)
          .then(response => response.json())
          .then(collectionData => {
            if(collectionData && collectionData.parts && collectionData.parts.length > 0) {
              collectionData.parts.forEach((movie, index) => {
                const movieSpan = document.createElement('span');
                movieSpan.textContent = movie.title;
                movieSpan.className = "clickable";
                movieSpan.setAttribute("tabindex", "0");
                movieSpan.addEventListener('click', () => {
                  searchInput.value = movie.title;
                  performSearch(movie.title);
                });
                movieSpan.addEventListener('keydown', (e) => {
                  if(e.key === "Enter"){
                    searchInput.value = movie.title;
                    performSearch(movie.title);
                  }
                });
                collectionDiv.appendChild(movieSpan);
                if(index < collectionData.parts.length - 1) {
                  collectionDiv.appendChild(document.createTextNode(", "));
                }
              });
            } else {
              collectionDiv.innerHTML += "None";
            }
            contentDiv.appendChild(collectionDiv);
          })
          .catch(error => {
            console.error("Error fetching collection details:", error);
            collectionDiv.innerHTML += "Error fetching collection";
            contentDiv.appendChild(collectionDiv);
          });
      }
      
      // Main Actors Section (comma-separated, clickable, no extra space before commas)
      if (item.credits && item.credits.cast && item.credits.cast.length > 0) {
        const actorsDiv = document.createElement('div');
        actorsDiv.className = "actors";
        
        const strongText = document.createElement('strong');
        strongText.textContent = "Main Actors: ";
        actorsDiv.appendChild(strongText);
      
        const mainActors = item.credits.cast.slice(0, 5);
        mainActors.forEach((actor, index) => {
          const actorSpan = document.createElement('span');
          actorSpan.textContent = actor.name;
          actorSpan.className = "clickable";
          actorSpan.style.padding = "0";
          actorSpan.style.margin = "0";
          actorSpan.setAttribute("tabindex", "0");
          actorSpan.addEventListener('click', () => {
            searchInput.value = actor.name;
            performSearch(actor.name);
          });
          actorSpan.addEventListener('keydown', (e) => {
            if (e.key === "Enter") {
              searchInput.value = actor.name;
              performSearch(actor.name);
            }
          });
          actorsDiv.appendChild(actorSpan);
          if (index < mainActors.length - 1) {
            actorsDiv.appendChild(document.createTextNode(", "));
          }
        });
        contentDiv.appendChild(actorsDiv);
      }
      
      // Streaming on Section with separators
      if(item["watch/providers"] && item["watch/providers"].results && item["watch/providers"].results.US) {
        const providers = item["watch/providers"].results.US.flatrate || item["watch/providers"].results.US.buy || [];
        if(providers.length > 0) {
          const streamDiv = document.createElement('div');
          streamDiv.className = "streaming";
          streamDiv.innerHTML = "<strong>Streaming on:</strong> ";
          providers.forEach((provider, index) => {
            const provSpan = document.createElement('span');
            provSpan.textContent = provider.provider_name;
            provSpan.style.marginRight = "1vw";
            streamDiv.appendChild(provSpan);
            if (index < providers.length - 1) {
              const sepSpan = document.createElement('span');
              sepSpan.textContent = " | ";
              sepSpan.style.marginRight = "1vw";
              streamDiv.appendChild(sepSpan);
            }
          });
          contentDiv.appendChild(streamDiv);
        }
      }
      
      div.appendChild(contentDiv);
      container.appendChild(div);
    }
    
    // Updated renderPersonResult with a 2-column grid for up to 20 credits,
    // plus a "Load More" button to load subsequent pages until all credits are seen.
    function renderPersonResult(item, container) {
      const div = document.createElement('div');
      div.className = "result";
      
      const img = document.createElement('img');
      if(item.profile_path) {
        img.src = baseImageUrl + item.profile_path;
      } else {
        img.alt = "No Image Available";
      }
      div.appendChild(img);
      
      const contentDiv = document.createElement('div');
      contentDiv.className = "result-content";
      
      const name = document.createElement('h2');
      name.textContent = item.name;
      contentDiv.appendChild(name);
      
      // Known For Section with pagination support
      const knownForDiv = document.createElement('div');
      knownForDiv.className = "known-for";
      knownForDiv.innerHTML = "<strong>Known For:</strong><br>";
      contentDiv.appendChild(knownForDiv);
      
      fetch(`https://api.themoviedb.org/3/person/${item.id}/combined_credits?api_key=${apiKey}`)
        .then(response => response.json())
        .then(creditsData => {
          let credits = creditsData.cast || [];
          const knownForGrid = document.createElement('div');
          knownForGrid.style.display = 'grid';
          knownForGrid.style.gridTemplateColumns = '1fr 1fr';
          knownForGrid.style.gap = '1vw';
          
          // Function to load a page of 20 credits starting at index startIndex
          function loadCreditsPage(startIndex) {
            for (let i = startIndex; i < Math.min(startIndex + 20, credits.length); i++) {
              const project = credits[i];
              const projectDiv = document.createElement('div');
              projectDiv.style.marginBottom = "1vw";
              
              const projectTitle = project.title || project.name || "Untitled";
              let releaseYear = "";
              if(project.release_date) {
                releaseYear = new Date(project.release_date).getFullYear();
              } else if(project.first_air_date) {
                releaseYear = new Date(project.first_air_date).getFullYear();
              }
              
              const titleSpan = document.createElement('span');
              titleSpan.textContent = releaseYear ? `${projectTitle} (${releaseYear})` : projectTitle;
              titleSpan.className = "clickable";
              titleSpan.setAttribute("tabindex", "0");
              titleSpan.addEventListener('click', () => {
                searchInput.value = projectTitle;
                performSearch(projectTitle);
              });
              titleSpan.addEventListener('keydown', (e) => {
                if(e.key === "Enter"){
                  searchInput.value = projectTitle;
                  performSearch(projectTitle);
                }
              });
              projectDiv.appendChild(titleSpan);
              knownForGrid.appendChild(projectDiv);
            }
            // If more credits remain, add a "Load More" button
            if (startIndex + 20 < credits.length) {
              const loadMoreDiv = document.createElement('div');
              loadMoreDiv.style.cursor = "pointer";
              loadMoreDiv.style.textAlign = "center";
              loadMoreDiv.style.gridColumn = "span 2";
              loadMoreDiv.textContent = "Load More";
              loadMoreDiv.className = "clickable";
              loadMoreDiv.addEventListener('click', () => {
                loadMoreDiv.remove();
                loadCreditsPage(startIndex + 20);
              });
              knownForGrid.appendChild(loadMoreDiv);
            }
          }
          
          // Load the first page (0 to 20)
          loadCreditsPage(0);
          knownForDiv.appendChild(knownForGrid);
        })
        .catch(error => {
          console.error("Error fetching person credits:", error);
          knownForDiv.innerHTML += "Error loading credits.";
        });
      
      div.appendChild(contentDiv);
      container.appendChild(div);
    }
    
    // Overlay functions for trailer playback using YouTube IFrame API with toggle mute and stop.
    function openOverlay(videoKey) {
      const overlayContent = document.getElementById('overlay-content');
      overlayContent.innerHTML = "";
      
      const playerDiv = document.createElement('div');
      playerDiv.id = "player";
      overlayContent.appendChild(playerDiv);
      
      const unmuteButton = document.createElement('button');
      unmuteButton.id = "unmute-button";
      unmuteButton.textContent = "Unmute";
      overlayContent.appendChild(unmuteButton);
      
      const stopButton = document.createElement('button');
      stopButton.id = "stop-button";
      stopButton.textContent = "Stop Trailer";
      overlayContent.appendChild(stopButton);
      
      player = new YT.Player('player', {
        height: '450',
        width: '100%',
        videoId: videoKey,
        playerVars: {
          autoplay: 1,
          mute: 1
        },
        events: {
          'onReady': function(event) {
            unmuteButton.addEventListener('click', function() {
              if (player.isMuted()) {
                player.unMute();
                unmuteButton.textContent = "Mute";
              } else {
                player.mute();
                unmuteButton.textContent = "Unmute";
              }
            });
            stopButton.addEventListener('click', function() {
              player.stopVideo();
              closeOverlay();
            });
          }
        }
      });
      
      document.getElementById('overlay').style.display = "flex";
    }

    function closeOverlay() {
      document.getElementById('overlay').style.display = "none";
    }

    document.getElementById('close-overlay').addEventListener('click', closeOverlay);

    document.getElementById('overlay').addEventListener('click', function(e) {
      if (e.target === this) {
        closeOverlay();
      }
    });
    
    window.onload = function() {
      document.getElementById('searchInput').focus();
    };
  </script>

  <!-- Overlay for trailer playback -->
  <div id="overlay" style="display: none;">
    <div id="overlay-content" style="position: relative; width: 80%; max-width: 800px;">
      <button id="close-overlay" style="position: absolute; top: -1vw; right: -1vw; background: #fff; color: #000; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 2.2vw; cursor: pointer;">&times;</button>
    </div>
  </div>
</body>
</html>
